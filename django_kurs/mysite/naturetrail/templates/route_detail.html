<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    {% load static %}
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" type="text/css">
    <link href="/static/css/main.css" rel="stylesheet" type="text/css">
    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&amp;apikey=616e0506-5ed7-42e4-87d2-595d4ed059a8" type="text/javascript"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg fixed-top" id="menu">
    <a class="navbar-brand" href="/">Home</a>
    <button aria-controls="navbarSupportedContent" aria-expanded="false"
            aria-label="Toggle navigation"
            class="navbar-toggler"
            data-target="#navbarSupportedContent" data-toggle="collapse"
            type="button">
        <span class="navbar-toggler-icon"></span>
    </button>
</nav>

<header class="header_route_detail">
    <div class="overlay_route_detail"></div>
    <div class="container">
        <div class="row">
            <div class="col-md-6 d-flex justify-content-between">
                <div class="description text-center">
                    <h3>
                        <p>
                            Национальный парк
                        </p>
                        ТАГАНАЙ
                    </h3>
                    <div class="preview2">Моё путешествие</div>
                </div>
            </div>
            <div class="col-md-6 d-flex justify-content-center align-items-center">
                {% block content %}
                
                {% endblock %}
            </div>
        </div>
    </div>
</header>

<!-- Posts section -->
<div class="gener" id="gener">
    <div class="container">
        <h1 class="text-center mt-4">Ваш маршрут</h1>
        <div class="row">
            <div class="one">
                <div class="card" id="card">
                    <div class="card-img2">
                        <!-- <img class="" src="/static/{{ picture_h }}"> -->
                    </div>
                    <div class="card-body" id="card-body">
                        <h4 class="card-title">{{name_h}}</h4>
                        <p class="card1-text">Сложность: {{ dificult_h }}</p>
                        <p class="card1-text">Продолжительность: {{ duration_h }}</p>
                        <p class="card-text4">{{ description_h }}</p>
                        <!-- <p class="card1-text">Источники воды: {{ water_h }}</p> -->
                        
                    </div>
                    <div id="map" style="width: 600px; height: 400px"></div>
                    <div class="container text-center mt-4">
                        <button id="save-pdf" class="btn btn-primary">Сохранить в PDF</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
     var myMap; // Глобальная переменная для объекта карты

    function init() {
        // Создаем массив координат точек маршрута
        var points = JSON.parse('{{ points_data|escapejs }}');

    // Создаем объект для хранения точек маршрута
    var referencePoints = [];

    // Заполняем массив координат точек маршрута
    points.forEach(function (point) {
        referencePoints.push([point.latitude, point.longitude]);
    });

    // Создаем мультимаршрут
    var multiRoute = new ymaps.multiRouter.MultiRoute({
        referencePoints: referencePoints,
        params: {
            routingMode: 'pedestrian'
        }
    }, {
        boundsAutoApply: true
    });

    // Создаем карту
    myMap = new ymaps.Map('map', {
        center: referencePoints[0],
        zoom: 12
    });

    // Добавляем мультимаршрут на карту
    myMap.geoObjects.add(multiRoute);
    }

    ymaps.ready(init);
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src='/static/js/main.js' type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"
    integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->

<script>
    document.getElementById('save-pdf').addEventListener('click', function () {
        // Element to capture
        var element = document.getElementById('card-body');

        // Get the hike name from the card title
        var hikeName = document.querySelector('.card-title').innerText.trim();

        var tempElement = document.createElement('div');

        // Append existing content from card-body
        var cardBodyContent = element.innerHTML;
        tempElement.innerHTML = cardBodyContent;

        var contactInfo = `
        Сообщить о возгораниях, чрезвычайных ситуациях, местах несанкционированного размещения отходов и иных нарушениях можно по телефонам:<br>
        +7-902-614-37-44 <br>
        +7-912-477-74-73<br> <!-- Добавление переноса строки -->
         <!-- Дополнительный перенос строки -->
        01 или 101 - Единый телефон пожарных и спасателей
    `;

        // Add contact information to the element content
        tempElement.innerHTML += contactInfo;
        
        // Options for html2pdf
        var opt = {
            margin: 1,
            filename: hikeName + '.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
        };

        // Generate PDF
        html2pdf().set(opt).from(tempElement).save().then(function () {
            console.log('PDF сохранен успешно');
            tempElement.remove();
        });
    });



</script>



<!-- <script>
    document.getElementById('save-pdf').addEventListener('click', function () {
        // Element to capture
        var element = document.getElementById('card-body');
        var hikeName = document.querySelector('.card-title').innerText.trim();

        html2canvas(document.getElementById('map')).then(function (canvas) {
            // Convert the canvas to an image
            var imgData = canvas.toDataURL('image/png');

            // Create an image element
            var imgElement = new Image();
            imgElement.src = imgData;

            // Replace the map with the screenshot
            var mapContainer = document.getElementById('map');
            mapContainer.innerHTML = '';
            mapContainer.appendChild(imgElement);


        // Options for html2pdf
        var opt = {
            margin:   1,
            filename: hikeName + '.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
        };

        // Generate PDF
        html2pdf().set(opt).from(element).save().then(function () {
                // Restore the original map
                mapContainer.innerHTML = '';
                ymaps.ready(init);
            });
    });
</script> -->
<hr>
<footer class="container">
    &copy; Все права защищены 2024
</footer>
<!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src='/static/js/main.js' type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0/html2canvas.min.js"></script> -->

</body>
</html>
